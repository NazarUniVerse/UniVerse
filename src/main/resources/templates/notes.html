<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Not Havuzu - UniVerse</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="/css/style.css">
</head>
<body style="padding-top: 80px;">

    <nav class="navbar navbar-expand-lg navbar-modern fixed-top">
        <div class="container">
            <a class="navbar-brand brand-logo" href="/home"><i class="fas fa-graduation-cap"></i> UniVerse</a>
            
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            
            <div class="collapse navbar-collapse justify-content-end" id="navbarNav">
                <ul class="navbar-nav align-items-center">
                    <li class="nav-item"><a class="nav-link" href="/home"><i class="fas fa-home me-1"></i> Akış</a></li>
                    <li class="nav-item"><a class="nav-link active fw-bold" href="/notes"><i class="fas fa-book me-1"></i> Notlar</a></li>
                    
                    <li class="nav-item"><a class="nav-link" href="/events"><i class="fas fa-calendar-alt me-1"></i> Etkinlikler</a></li>
                    
                    <li class="nav-item mx-2">
                        <a class="nav-link position-relative" href="/notifications">
                            <i class="fas fa-bell fa-lg"></i>
                            <span th:if="${unreadCount > 0}" class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger border border-light" style="font-size: 0.6rem;">
                                <span th:text="${unreadCount}">0</span>
                            </span>
                        </a>
                    </li>
                    
                    <li class="nav-item dropdown ms-3">
                        <a class="nav-link dropdown-toggle d-flex align-items-center p-0" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                            <img th:src="@{${user.avatarPath}}" class="rounded-circle border border-2 shadow-sm" width="45" height="45" style="object-fit: cover; border-color: var(--primary-color) !important;">
                        </a>
                        <ul class="dropdown-menu dropdown-menu-end border-0 shadow-lg mt-3 p-2" style="min-width: 220px;">
                            <li><h6 class="dropdown-header fw-bold text-primary" th:text="${user.fullname}">Kullanıcı</h6></li>
                            <li><hr class="dropdown-divider"></li>
                            
                            <li th:if="${user.email == 'admin@universe.edu.tr'}">
                                <a class="dropdown-item rounded text-danger fw-bold bg-light mb-2" href="/admin/messages">
                                    <i class="fas fa-user-shield me-2"></i> Yönetici Paneli
                                </a>
                            </li>

                            <li><a class="dropdown-item rounded" href="/profile"><i class="fas fa-user me-2 text-muted"></i> Profilim</a></li>
                            <li><a class="dropdown-item rounded" href="/settings"><i class="fas fa-cog me-2 text-muted"></i> Ayarlar</a></li>
                            
                            <li><hr class="dropdown-divider"></li>
                            <li><a class="dropdown-item rounded text-danger fw-bold" href="/logout"><i class="fas fa-sign-out-alt me-2"></i> Çıkış Yap</a></li>
                        </ul>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <div class="container">
        
        <div class="row mb-4 align-items-center">
            <div class="col-md-6">
                <h3 class="fw-bold text-primary"><i class="fas fa-copy me-2"></i> Ders Notları & Materyaller</h3>
                <p class="text-muted">Arkadaşlarının paylaştığı notları indir veya sen yükle.</p>
            </div>
            <div class="col-md-6 text-end">
                <button class="btn btn-primary-modern rounded-pill px-4" data-bs-toggle="modal" data-bs-target="#uploadNoteModal">
                    <i class="fas fa-cloud-upload-alt me-2"></i> Not Yükle
                </button>
            </div>
        </div>

        <div class="d-flex overflow-auto pb-3 mb-3 custom-scrollbar">
            <a href="/notes" th:classappend="${activeDept == null} ? 'btn-primary-modern text-white' : 'bg-white text-muted'" class="btn rounded-pill me-2 border fw-bold text-nowrap">Tümü</a>
            <a href="/notes?dept=Bilgisayar Mühendisliği" th:classappend="${activeDept == 'Bilgisayar Mühendisliği'} ? 'btn-primary-modern text-white' : 'bg-white text-muted'" class="btn rounded-pill me-2 border fw-bold text-nowrap">Bilgisayar Müh.</a>
            <a href="/notes?dept=Yazılım Mühendisliği" th:classappend="${activeDept == 'Yazılım Mühendisliği'} ? 'btn-primary-modern text-white' : 'bg-white text-muted'" class="btn rounded-pill me-2 border fw-bold text-nowrap">Yazılım Müh.</a>
            <a href="/notes?dept=Tıp Fakültesi" th:classappend="${activeDept == 'Tıp Fakültesi'} ? 'btn-primary-modern text-white' : 'bg-white text-muted'" class="btn rounded-pill me-2 border fw-bold text-nowrap">Tıp</a>
            <a href="/notes?dept=İşletme" th:classappend="${activeDept == 'İşletme'} ? 'btn-primary-modern text-white' : 'bg-white text-muted'" class="btn rounded-pill me-2 border fw-bold text-nowrap">İşletme</a>
        </div>

        <div class="row g-4">
            <div th:if="${#lists.isEmpty(notes)}" class="col-12 text-center py-5">
                <div class="text-muted opacity-50 display-1"><i class="fas fa-folder-open"></i></div>
                <h5 class="mt-3 fw-bold text-muted">Henüz not yüklenmemiş.</h5>
                <p class="small text-muted">İlk notu yükleyen sen ol!</p>
            </div>

            <div th:each="note : ${notes}" class="col-md-6 col-lg-4">
                <div class="card glass-card h-100 border-0 shadow-sm hover-effect">
                    <div class="card-body">
                        <div class="d-flex justify-content-between align-items-start mb-3">
                            <div class="d-flex align-items-center">
                                <div class="bg-light rounded-circle p-2 text-primary me-2 shadow-sm" style="width: 45px; height: 45px; display: flex; align-items: center; justify-content: center;">
                                    <i class="fas fa-file-pdf fa-lg" th:if="${note.fileName.endsWith('.pdf')}"></i>
                                    <i class="fas fa-file-word fa-lg" th:if="${note.fileName.endsWith('.docx')}"></i>
                                    <i class="fas fa-file-image fa-lg" th:if="${note.fileName.endsWith('.jpg') || note.fileName.endsWith('.png')}"></i>
                                    <i class="fas fa-file-alt fa-lg" th:unless="${note.fileName.endsWith('.pdf') || note.fileName.endsWith('.docx') || note.fileName.endsWith('.jpg')}"></i>
                                </div>
                                <div>
                                    <h6 class="fw-bold mb-0 text-truncate" style="max-width: 150px;" th:text="${note.title}">Ders Notu</h6>
                                    <small class="text-muted" style="font-size: 0.75rem;" th:text="${note.department}">Bölüm</small>
                                </div>
                            </div>
                            <small class="text-muted" th:text="${#temporals.format(note.createdAt, 'dd MMM')}">Tarih</small>
                        </div>
                        
                        <p class="text-muted small mb-4" th:text="${note.description}">Açıklama...</p>
                        
                        <div class="d-flex justify-content-between align-items-center mt-auto">
                            <div class="d-flex align-items-center">
                                <img th:src="@{${note.uploader.avatarPath}}" class="rounded-circle me-2 border" width="25" height="25">
                                <small class="text-muted fw-bold" th:text="${note.uploader.fullname}">Kullanıcı</small>
                            </div>
                            <a th:href="@{'/notes/download/' + ${note.id}}" class="btn btn-sm btn-outline-primary rounded-pill px-3">
                                <i class="fas fa-download me-1"></i> İndir
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="uploadNoteModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content border-0 shadow-lg">
                <div class="modal-header bg-light border-0">
                    <h5 class="modal-title fw-bold text-primary"><i class="fas fa-cloud-upload-alt me-2"></i> Not Yükle</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <form action="/notes/upload" method="post" enctype="multipart/form-data">
                    <div class="modal-body p-4">
                        <div class="mb-3">
                            <label class="form-label small fw-bold">Ders Adı / Başlık</label>
                            <input type="text" name="title" class="form-control rounded-pill" placeholder="Örn: Fizik 101 Vize Notları" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label small fw-bold">Bölüm</label>
                            <select name="department" class="form-select rounded-pill" required>
                                <option value="" disabled selected>Hangi bölüm için?</option>
                                <option value="Bilgisayar Mühendisliği">Bilgisayar Mühendisliği</option>
                                <option value="Yazılım Mühendisliği">Yazılım Mühendisliği</option>
                                <option value="Endüstri Mühendisliği">Endüstri Mühendisliği</option>
                                <option value="Tıp Fakültesi">Tıp Fakültesi</option>
                                <option value="İşletme">İşletme</option>
                                <option value="Mimarlık">Mimarlık</option>
                                <option value="Psikoloji">Psikoloji</option>
                                <option value="Diğer">Diğer</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label class="form-label small fw-bold">Açıklama</label>
                            <textarea name="description" class="form-control" rows="3" placeholder="Bu notta neler var? (Örn: 1-5. ünite özeti)"></textarea>
                        </div>
                        <div class="mb-3">
                            <label class="form-label small fw-bold">Dosya Seç (PDF, Resim)</label>
                            <input type="file" name="file" class="form-control" required>
                        </div>
                    </div>
                    <div class="modal-footer border-0">
                        <button type="button" class="btn btn-light rounded-pill" data-bs-dismiss="modal">İptal</button>
                        <button type="submit" class="btn btn-primary-modern rounded-pill px-4">Paylaş</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script th:inline="javascript">
        (function() {
            let savedTheme = localStorage.getItem('theme') || 'light';
            const isVip = [[${user.isVip}]];
            if(savedTheme === 'gold' && !isVip) {
                savedTheme = 'light';
                localStorage.setItem('theme', 'light');
            }
            document.documentElement.setAttribute('data-theme', savedTheme);
        })();
    </script>
</body>
</html>